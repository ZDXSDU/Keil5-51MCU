C51 COMPILER V9.60.7.0   DS1302                                                            08/16/2023 15:15:32 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DS1302
OBJECT MODULE PLACED IN .\Objects\DS1302.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE DS1302.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\DS
                    -1302.lst) OBJECT(.\Objects\DS1302.obj)

line level    source

   1          // Header: é©±åŠ¨DS1302æ•°å­—æ—¶é’Ÿçš„å‡½æ•°
   2          // File Name: DS1302.c
   3          // Author: ZDXSDU
   4          // Date: Aug.15,2023
   5          #include <REGX52.H>
   6          #define DS1302_Second_Write 0x80
   7          #define DS1302_Minute_Write 0x82
   8          #define DS1302_Hour_Write 0x84
   9          #define DS1302_Day_Write 0x86
  10          #define DS1302_Month_Write 0x88
  11          #define DS1302_Week_Write 0x8A
  12          #define DS1302_Year_Write 0x8C
  13          #define DS1302_WP 0x8E
  14          sbit DS1302_SCLK = P3^6; // DS1302èŠ¯ç‰‡çš„ä¸²è¡Œæ—¶é’Ÿå¼•è„š
  15          sbit DS1302_IO = P3^4; // DS1302èŠ¯ç‰‡çš„ä¸²è¡Œæ•°æ®å¼•è„š
  16          sbit DS1302_CE = P3^5; // DS1302èŠ¯ç‰‡çš„èŠ¯ç‰‡ä½¿èƒ½å¼•è„šï¼ˆé«˜ç”µå¹³æœ‰æ•ˆï¼‰
  17          unsigned char DS1302_Time[] = {23, 8, 16, 14, 4, 00, 3}; // å¹´æœˆæ—¥æ—¶åˆ†ç§’å‘¨
  18          /**
  19          * @brief DS1302åˆå§‹åŒ–
  20          * @param  æ— 
  21          * @retval æ— 
  22          * @interpretation ç”±äºMCUä¸Šç”µæ—¶I/Oå£å‡ä¸ºé«˜ç”µå¹³ï¼Œéœ€è¦ç»™DS1302çš„æ—¶é’Ÿå’Œä½¿èƒ½å¼•è„šä½ç”µå
             -¹³
  23          */
  24          void DS1302_Init(void)
  25          {
  26   1              DS1302_CE = 0;
  27   1              DS1302_SCLK = 0;
  28   1      }
  29          /**
  30          * @brief å‘DS1302å†™å…¥æ•°æ®
  31          * @param Commandï¼šå‘½ä»¤å­—
  32          * @param Dataï¼šå†™å…¥çš„æ•°æ®å­—èŠ‚
  33          * @retval æ— 
  34          * @interpretation æè¿°
  35          */
  36          void DS1302_WriteByte(unsigned char Command, Data)
  37          {
  38   1              unsigned char i;
  39   1              DS1302_CE = 1; // èŠ¯ç‰‡ä½¿èƒ½å¼•è„šç»™é«˜ç”µå¹³ä½¿å…¶æœ‰æ•ˆ    
  40   1              for(i = 0; i < 8; i++)
  41   1              {
  42   2                      DS1302_IO = Command & (0x01 << i); // å–å‡ºå‘½ä»¤å­—çš„ç¬¬iä½
  43   2                      DS1302_SCLK = 1; // ä¸Šå‡æ²¿å°†æ•°æ®å†™å…¥DS1302
  44   2                      DS1302_SCLK = 0; // æ¢å¤ä¸²è¡Œæ—¶é’Ÿç½®0
  45   2              }
  46   1              for(i = 0; i < 8; i++)
  47   1              {
  48   2                      DS1302_IO = Data & (0x01 << i); // å–å‡ºDataå­—èŠ‚çš„ç¬¬iä½
  49   2                      DS1302_SCLK = 1; // ä¸Šå‡æ²¿å°†æ•°æ®å†™å…¥DS1302
  50   2                      DS1302_SCLK = 0; // æ¢å¤ä¸²è¡Œæ—¶é’Ÿç½®0
  51   2              }
  52   1              DS1302_CE = 0; // å…³é—­èŠ¯ç‰‡ä½¿èƒ½
  53   1      }
C51 COMPILER V9.60.7.0   DS1302                                                            08/16/2023 15:15:32 PAGE 2   

  54          /**
  55          * @brief å‘DS1302è¯»å–æ•°æ®
  56          * @param Commandï¼šå‘½ä»¤å­—
  57          * @retval [char]: DS1302è¿”å›çš„æ•°æ®
  58          * @interpretation  æè¿°
  59          */
  60          unsigned char DS1302_ReadByte(unsigned char Command)
  61          {
  62   1              unsigned char i, Data = 0x00;
  63   1              DS1302_CE = 1; // èŠ¯ç‰‡ä½¿èƒ½å¼•è„šç»™é«˜ç”µå¹³ä½¿å…¶æœ‰æ•ˆ
  64   1              for(i = 0; i < 8; i++)
  65   1              {
  66   2                      DS1302_IO = Command & (0x01 << i); // å–å‡ºå‘½ä»¤å­—çš„ç¬¬iä½
  67   2                      // ç”±äºDS1302çš„å†™å…¥å’Œè¯»å–çš„æ—¶åºä¸ä¸€æ ·ï¼Œè¿™é‡Œéœ€è¦å…ˆç»™0å†ç»™1
  68   2                      DS1302_SCLK = 0; // æ¢å¤ä¸²è¡Œæ—¶é’Ÿç½®0
  69   2                      DS1302_SCLK = 1; // ä¸Šå‡æ²¿å°†æ•°æ®å†™å…¥DS1302
  70   2              }
  71   1              for(i = 0; i < 8; i++)
  72   1              {
  73   2                      // è¿™é‡Œåœ¨å–æ•°æ®çš„æ—¶å€™åˆå°†æ—¶åºåäº†è¿‡æ¥ï¼ŒåŸå› æ˜¯å¦‚æœå…ˆ0å1ä¼šé€ æˆå¤šç»™äº†ä¸€ä¸ª
             -è„‰å†²å‘¨æœŸ
  74   2                      DS1302_SCLK = 1; // æ¢å¤ä¸²è¡Œæ—¶é’Ÿç½®1
  75   2                      DS1302_SCLK = 0; // ä¸‹é™æ²¿è¯»å–DS1302çš„æ•°æ®              
  76   2                      if(DS1302_IO)
  77   2                              Data |= (0x01 << i); // å¦‚æœDS1302çš„è¿”å›å€¼æ˜¯1ï¼Œé‚£ä¹ˆå°±å°†æ¥æ”¶å˜é‡Dataå¯¹åº”ä½ç½®ä¹Ÿå˜æˆ
             -1
  78   2              }
  79   1              DS1302_CE = 0; // å…³é—­èŠ¯ç‰‡ä½¿èƒ½
  80   1              DS1302_IO = 0; // å°†ä¸²è¡Œæ•°æ®å£æ¸…é›¶ï¼Œé˜²æ­¢è¯»å‡ºçš„ä¸å¯¹
  81   1              return Data;
  82   1      }
  83          /**
  84          * @brief å°†ä¸Šæ–¹çš„DS1302_Timeä¸­çš„æ—¶é—´å†™å…¥åˆ°DS1302ä¸­
  85          * @param  æ— 
  86          * @retval æ— 
  87          * @interpretation  æè¿°
  88          */
  89          void DS1302_SetTime(void)
  90          {
  91   1              DS1302_WriteByte(DS1302_WP, 0x00); // å…³é—­DS1302èŠ¯ç‰‡å†™ä¿æŠ¤
  92   1              DS1302_WriteByte(DS1302_Year_Write, DS1302_Time[0] / 10 * 16 + DS1302_Time[0] % 10); // å°†å¹´è½¬æˆBCDç 
             -åï¼Œå†™å…¥DS1302
  93   1              DS1302_WriteByte(DS1302_Month_Write, DS1302_Time[1] / 10 * 16 + DS1302_Time[1] % 10); // å°†æœˆè½¬æˆBCDç
             - åï¼Œå†™å…¥DS1302
  94   1              DS1302_WriteByte(DS1302_Day_Write, DS1302_Time[2] / 10 * 16 + DS1302_Time[2] % 10); // å°†æ—¥æœŸè½¬æˆBCD
             -ç åï¼Œå†™å…¥DS1302
  95   1              DS1302_WriteByte(DS1302_Hour_Write, DS1302_Time[3] / 10 * 16 + DS1302_Time[3] % 10); // å°†å°æ—¶è½¬æˆBC
             -Dç åï¼Œå†™å…¥DS1302
  96   1              DS1302_WriteByte(DS1302_Minute_Write, DS1302_Time[4] / 10 * 16 + DS1302_Time[4] % 10); // å°†åˆ†é’Ÿè½¬æˆ
             -BCDç åï¼Œå†™å…¥DS1302
  97   1              DS1302_WriteByte(DS1302_Second_Write, DS1302_Time[5] / 10 * 16 + DS1302_Time[5] % 10); // å°†ç§’è½¬æˆBCD
             -ç åï¼Œå†™å…¥DS1302
  98   1              DS1302_WriteByte(DS1302_Week_Write, DS1302_Time[6] / 10 * 16 + DS1302_Time[6] % 10); // å°†æ˜ŸæœŸå‡ è½¬æˆ
             -BCDç åï¼Œå†™å…¥DS1302
  99   1              DS1302_WriteByte(DS1302_WP, 0x80); // æ‰“å¼€DS1302èŠ¯ç‰‡å†™ä¿æŠ¤
 100   1      }
 101          /**
 102          * @brief æŠŠDS1302ä¸­çš„æ—¶é—´è¯»å–å‡ºæ¥æ”¾åˆ°ä¸Šæ–¹çš„DS1302_Timeæ•°ç»„ä¸­
 103          * @param  æ— 
 104          * @retval æ— 
 105          * @interpretation  æè¿°
 106          */
C51 COMPILER V9.60.7.0   DS1302                                                            08/16/2023 15:15:32 PAGE 3   

 107          void DS1302_GetTime(void)
 108          {
 109   1              unsigned char RetvalTemp; // è¿™é‡Œå®šä¹‰ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œé˜²æ­¢åœ¨BCDè½¬DECçš„æ—¶å€™ä¸¤æ¬¡è°ƒç”¨è¿”å
             -›çš„å€¼ä¸å¯¹ï¼ˆæ—¶é—´æ€»æ˜¯ä¼šæµé€çš„ï¼‰
 110   1              // ç”±äºä¸Šæ–¹å®šä¹‰çš„åœ°å€éƒ½æ˜¯å†™æ•°æ®çš„åœ°å€ï¼Œå¹¶ä¸”è¯»çš„åœ°å€ç›¸å½“äºå†™åœ°å€çš„LSBä½æ”¹
             -æˆ1ï¼Œå› æ­¤éœ€è¦å¯¹å…¶æˆ–ç­‰äºï¼Œå°†æœ€ä½ä¸ºæ”¹æˆé›¶
 111   1              RetvalTemp = DS1302_ReadByte(DS1302_Year_Write | 0x01);
 112   1              DS1302_Time[0] = RetvalTemp / 16 * 10 + RetvalTemp % 16;
 113   1              RetvalTemp = DS1302_ReadByte(DS1302_Month_Write | 0x01);
 114   1              DS1302_Time[1] = RetvalTemp / 16 * 10 + RetvalTemp % 16;
 115   1              RetvalTemp = DS1302_ReadByte(DS1302_Day_Write | 0x01);
 116   1              DS1302_Time[2] = RetvalTemp / 16 * 10 + RetvalTemp % 16;
 117   1              RetvalTemp = DS1302_ReadByte(DS1302_Hour_Write | 0x01);
 118   1              DS1302_Time[3] = RetvalTemp / 16 * 10 + RetvalTemp % 16;
 119   1              RetvalTemp = DS1302_ReadByte(DS1302_Minute_Write | 0x01);
 120   1              DS1302_Time[4] = RetvalTemp / 16 * 10 + RetvalTemp % 16;
 121   1              RetvalTemp = DS1302_ReadByte(DS1302_Second_Write | 0x01);
 122   1              DS1302_Time[5] = RetvalTemp / 16 * 10 + RetvalTemp % 16;
 123   1              RetvalTemp = DS1302_ReadByte(DS1302_Week_Write | 0x01);
 124   1              DS1302_Time[6] = RetvalTemp / 16 * 10 + RetvalTemp % 16;
 125   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    548    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
