C51 COMPILER V9.60.7.0   IR                                                                09/15/2023 08:23:18 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE IR
OBJECT MODULE PLACED IN .\Objects\IR.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE IR.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\IR.lst
                    -) OBJECT(.\Objects\IR.obj)

line level    source

   1          #include <STC89C5xRC.H>
   2          #include "Timer0.h"
   3          #include "Int0.h"
   4          unsigned int IR_Time; // è®¡æ—¶æ—¶é—´
   5          unsigned char IR_Status; // çº¢å¤–çš„çŠ¶æ€æœºï¼›ã€0ç©ºé—²ï¼Œ1æ¥æ”¶åˆ°startä¿¡å·ï¼Œ2æ¥æ”¶æ•°æ®å¹¶è§£ç
             - ã€‘
   6          unsigned char IR_Data[4]; // ä½¿ç”¨charç±»å‹çš„4é•¿åº¦æ•°ç»„æ¥å­˜å‚¨çº¢å¤–æ¥æ”¶å¤´æ¥æ”¶åˆ°çš„æ•°æ®ï¼Œ
             -è¿™é‡Œä¸é€‚ç”¨longç±»å‹çš„åŸå› æ˜¯å› ä¸º<<å’Œ>>åªèƒ½æ“ä½œ16ä½ä»¥å†…çš„æ•°æ®ï¼Œå¯¹äº32ä½çš„longç±»å‹æ“ä½œå·¦ç§
             -»å³ç§»ä¼šå‡ºç°é—®é¢˜
   7          unsigned char IR_pData; // å®šä¹‰å½“å‰è¯»åˆ°äº†ç¬¬å‡ ä½ï¼Œå¦‚æœè¯»æ»¡32ä½ï¼Œå°±è®¤ä¸ºæ¥å—ç»“æŸ
   8          unsigned char IR_DataFlag; // æ•°æ®æ¥æ”¶å®Œæ¯•æ ‡è¯†ä½
   9          unsigned char IR_RepeatFlag; // é‡å‘æ ‡è¯†
  10          unsigned char IR_Address; // çº¢å¤–æ¥æ”¶åˆ°çš„åœ°å€ç 
  11          unsigned char IR_Command; // çº¢å¤–æ¥æ”¶åˆ°çš„å‘½ä»¤å­—
  12          void IR_Init(void)
  13          {
  14   1              Timer0_Init();
  15   1              Int0_Init();
  16   1      }
  17          void Int0_Rountine(void)  interrupt 0
  18          {
  19   1              switch(IR_Status)
  20   1              {
  21   2                      case 0: 
  22   2                      {
  23   3                              Timer0_SetCounter(0);
  24   3                              Timer0_Run(1);
  25   3                              IR_Status = 1;
  26   3                              break;
  27   3                      }
  28   2                      case 1:
  29   2                      {
  30   3                              IR_Time = Timer0_GetCounter();
  31   3                              Timer0_SetCounter(0);
  32   3                              if(IR_Time >= (9000 + 4500) - 500 && IR_Time <= (9000 + 4500) + 500)
  33   3                              { // Start ä¿¡å·
  34   4                                      IR_Status = 2;
  35   4                              }
  36   3                              else if(IR_Time >= (9000 + 2250) - 500 && IR_Time <= (9000 + 2250) + 500)
  37   3                              { // Repeat ä¿¡å·
  38   4                                      IR_RepeatFlag = 1;
  39   4                                      Timer0_Run(0);
  40   4                                      IR_Status = 0;
  41   4                              }
  42   3                              else
  43   3                              {
  44   4                                      IR_Status = 1;
  45   4                              }
  46   3                              break;
  47   3                      }
  48   2                      case 2:
  49   2                      {
  50   3                              IR_Time = Timer0_GetCounter();
  51   3                              Timer0_SetCounter(0);
C51 COMPILER V9.60.7.0   IR                                                                09/15/2023 08:23:18 PAGE 2   

  52   3                              if(IR_Time >= (560 + 560) - 500 && IR_Time <= (560 + 560) + 500)
  53   3                              { // Logical"0"
  54   4                                      IR_Data[IR_pData / 8] &= ~(0x01 << (IR_pData % 8));
  55   4                                      IR_pData++;
  56   4                              }
  57   3                              else if(IR_Time >= (560 + 1690) -500 && IR_Time <= (560 + 1690) + 500)
  58   3                              { // Logical"1"
  59   4                                      IR_Data[IR_pData / 8] |= 0x01 << (IR_pData % 8);
  60   4                                      IR_pData++;
  61   4                              }
  62   3                              else
  63   3                              { // Error
  64   4                                      IR_pData = 0;
  65   4                                      IR_Status = 1;
  66   4                              }
  67   3                              if(IR_pData >= 32)
  68   3                              { // 
  69   4                                      IR_pData = 0;
  70   4                                      if((IR_Data[0] == ~IR_Data[1]) &&(IR_Data[2] == ~IR_Data[3]))
  71   4                                      {                                       
  72   5                                              IR_Address = IR_Data[0];
  73   5                                              IR_Command = IR_Data[2];
  74   5                                              IR_DataFlag = 1;
  75   5                                      }
  76   4                                      Timer0_Run(0);
  77   4                                      IR_Status = 0;
  78   4                              }
  79   3                      }
  80   2                      default:
  81   2                      { 
  82   3                              break;
  83   3                      }
  84   2              }
  85   1      }
  86          unsigned char IR_GetDataFalg(void)
  87          {
  88   1              if(IR_DataFlag)
  89   1              {
  90   2                      IR_DataFlag = 0;
  91   2                      return 1;
  92   2              }
  93   1              else
  94   1              {
  95   2                      return 0;
  96   2              }
  97   1      }
  98          unsigned char IR_GetRepeatFlag(void)
  99          {
 100   1              if(IR_RepeatFlag)
 101   1              {
 102   2                      IR_RepeatFlag = 0;
 103   2                      return 1;
 104   2              }
 105   1              else
 106   1              {
 107   2                      return 0;
 108   2              }
 109   1      }
 110          unsigned char IR_GetAddress(void)
 111          {
 112   1              return IR_Address;
 113   1      }
C51 COMPILER V9.60.7.0   IR                                                                09/15/2023 08:23:18 PAGE 3   

 114          unsigned char IR_GetCommand(void)
 115          {
 116   1              return IR_Command;
 117   1      }
 118          /*
 119          å¤–éƒ¨ä¸­æ–­Int0è®¾ç½®ä¸ºä¸‹é™æ²¿è§¦å‘ï¼Œå¦‚æœä»–æ£€æµ‹åˆ°äº†ä¸‹é™æ²¿å¹¶è¿›å…¥äº†ä¸­æ–­å‡½æ•°ï¼Œå°±å¼€
             -å¯è®¡æ—¶å™¨åŒæ—¶å°†çº¢å¤–çŠ¶æ€æœºçš„çŠ¶æ€æ”¹ä¸º1ï¼Œ
 120          ä¸‹æ¬¡ä¸‹é™æ²¿è§¦å‘æ—¶ï¼Œæ‹¿åˆ°è®¡æ—¶å™¨çš„å€¼ï¼Œå¹¶è®©è®¡æ—¶å™¨é‡æ–°å¼€å§‹è®¡æ—¶ï¼ŒåŒæ—¶åˆ¤æ–­è®¡æ—¶å
             -™¨çš„å€¼æ˜¯ä¸æ˜¯åœ¨startæ—¶é—´ä¸Šä¸‹500usçš„æ³¢åŠ¨èŒƒå›´å†…ï¼Œå¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ¥æ”¶æœºå·²ç»æ¥æ”¶åˆ°äº†sta
             -rtä¿¡å·ï¼Œå¹¶å°†çº¢å¤–çŠ¶æ€æœºçš„çŠ¶æ€ä¿®æ”¹ä¸º2ï¼›å¦‚æœæ—¶é—´æ˜¯åœ¨Repeatçš„æ—¶é—´ä¸Šä¸‹500uså†…ï¼Œåˆ™è®¤ä¸ºæ¥æ”¶å
             -ˆ°äº†é‡å‘ä¿¡å· åŒæ—¶çŠ¶æ€æœºä¿®æ”¹ä¸º0ï¼Œé‡å‘çŠ¶æ€æ ‡è¯†ç½®ä¸º1,åœæ­¢è®¡æ—¶å™¨ï¼›å¦‚æœéƒ½ä¸æ˜¯ï¼Œé‚£å°±è®¤ä¸º
             -æ¥æ”¶å¤´æ¥æ”¶åˆ°äº†é”™è¯¯çš„æ•°æ®ï¼Œå°†æ¥æ”¶æ ‡è¯†ä½ç½®ä¸º1ï¼Œé‡æ–°æ¥æ”¶
 121          */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    369    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
